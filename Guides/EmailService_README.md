# Email Service Setup v√† Usage Guide

## T·ªïng quan
JobMatchingSystem.Infrastructure.Services.EmailService cung c·∫•p c√°c ch·ª©c nƒÉng g·ª≠i email cho h·ªá th·ªëng tuy·ªÉn d·ª•ng, bao g·ªìm:

- **Welcome Email**: Email ch√†o m·ª´ng ng∆∞·ªùi d√πng m·ªõi ƒëƒÉng k√Ω
- **Email Confirmation**: Email x√°c nh·∫≠n ƒë·ªãa ch·ªâ email
- **Password Reset**: Email reset m·∫≠t kh·∫©u  
- **Job Status Update**: Email th√¥ng b√°o thay ƒë·ªïi tr·∫°ng th√°i ·ª©ng tuy·ªÉn
- **Custom Email**: G·ª≠i email t√πy ch·ªânh

## C·∫•u h√¨nh

### 1. Trong appsettings.json:
```json
{
  "EmailSettings": {
    "SmtpServer": "smtp.gmail.com",
    "SmtpPort": 587,
    "SenderEmail": "your-email@gmail.com", 
    "SenderName": "JobMatching System",
    "Username": "your-email@gmail.com",
    "Password": "your-app-password",
    "EnableSsl": true
  }
}
```

### 2. Dependency Injection (Program.cs):
```csharp
using JobMatchingSystem.Infrastructure.Configuration;
using JobMatchingSystem.Infrastructure.IServices;
using JobMatchingSystem.Infrastructure.Services;

// Configure EmailSettings
builder.Services.Configure<EmailSettings>(
    builder.Configuration.GetSection("EmailSettings"));

// Register EmailService
builder.Services.AddScoped<IEmailService, EmailService>();
```

## C·∫•u h√¨nh Gmail SMTP

### B∆∞·ªõc 1: B·∫≠t 2-Step Verification
1. V√†o [Google Account Settings](https://myaccount.google.com/)
2. Security ‚Üí 2-Step Verification ‚Üí Enable

### B∆∞·ªõc 2: T·∫°o App Password
1. Security ‚Üí App passwords
2. Ch·ªçn app: Mail
3. Copy app password (16 k√Ω t·ª±)
4. S·ª≠ d·ª•ng app password n√†y trong `appsettings.json`

### B∆∞·ªõc 3: C·∫•u h√¨nh SMTP
- **SMTP Server**: smtp.gmail.com
- **Port**: 587 (TLS) ho·∫∑c 465 (SSL)
- **EnableSsl**: true
- **Username**: ƒê·ªãa ch·ªâ Gmail c·ªßa b·∫°n
- **Password**: App password (kh√¥ng ph·∫£i m·∫≠t kh·∫©u Gmail)

## S·ª≠ d·ª•ng trong Controller

```csharp
public class AccountController : Controller
{
    private readonly IEmailService _emailService;
    
    public AccountController(IEmailService emailService)
    {
        _emailService = emailService;
    }
    
    [HttpPost]
    public async Task<IActionResult> Register(RegisterModel model)
    {
        // Logic ƒëƒÉng k√Ω user...
        
        // G·ª≠i welcome email + email confirmation
        var confirmationLink = Url.Action("ConfirmEmail", "Account", 
            new { token = confirmationToken, email = model.Email }, Request.Scheme);
            
        var result = await _emailService.SendWelcomeEmailAsync(
            model.Email, 
            model.FullName, 
            confirmationLink);
            
        if (!result.Success)
        {
            // Handle email sending failure
            _logger.LogError($"Failed to send welcome email: {result.Message}");
        }
        
        return View("RegisterSuccess");
    }
}
```

## C√°c Template Email

### 1. Welcome Email
- **M√†u s·∫Øc**: Gradient t√≠m xanh
- **N·ªôi dung**: Ch√†o m·ª´ng + link x√°c nh·∫≠n email
- **Call-to-action**: "Confirm My Email"

### 2. Email Confirmation  
- **M√†u s·∫Øc**: Xanh l√°
- **N·ªôi dung**: Y√™u c·∫ßu x√°c nh·∫≠n email
- **Th·ªùi h·∫°n**: 24 gi·ªù
- **Call-to-action**: "Confirm Email Address"

### 3. Password Reset
- **M√†u s·∫Øc**: ƒê·ªè
- **N·ªôi dung**: Link reset password + c·∫£nh b√°o b·∫£o m·∫≠t
- **Th·ªùi h·∫°n**: 1 gi·ªù  
- **Call-to-action**: "Reset My Password"

### 4. Job Status Update
- **M√†u s·∫Øc**: ƒê·ªông theo tr·∫°ng th√°i
  - `accepted/hired`: Xanh l√° (#28a745) üéâ
  - `rejected/declined`: ƒê·ªè (#dc3545) üòî
  - `interview/shortlisted`: V√†ng (#ffc107) üìû
  - Kh√°c: Xanh d∆∞∆°ng (#17a2b8) üìã
- **N·ªôi dung**: Th√¥ng tin job + tr·∫°ng th√°i + message t√πy ch·ªçn

## V√≠ d·ª• S·ª≠ d·ª•ng

### Welcome Email
```csharp
var result = await _emailService.SendWelcomeEmailAsync(
    "user@example.com",
    "John Doe", 
    "https://yoursite.com/confirm?token=abc123");
```

### Job Status Update
```csharp
var result = await _emailService.SendJobStatusUpdateEmailAsync(
    "candidate@example.com",
    "Jane Smith",
    "Senior Developer", 
    "Tech Corp",
    "interview",
    "Congratulations! Please schedule your interview.");
```

### Password Reset
```csharp
var result = await _emailService.SendPasswordResetEmailAsync(
    "user@example.com",
    "John Doe",
    "https://yoursite.com/reset?token=xyz789");
```

## Testing

Project c√≥ 20 unit tests bao g·ªìm:
- Template generation tests
- SMTP failure handling  
- Email validation
- Status color mapping
- Message handling (null/empty)

```bash
dotnet test JobMatchingSystem.UnitTest
```

## Security Best Practices

1. **Kh√¥ng commit credentials**: S·ª≠ d·ª•ng User Secrets ho·∫∑c Environment Variables
2. **App Passwords**: Lu√¥n d√πng app password thay v√¨ m·∫≠t kh·∫©u th·∫≠t
3. **HTTPS**: Ch·ªâ g·ª≠i links HTTPS trong email
4. **Token expiration**: ƒê·∫∑t th·ªùi h·∫°n cho confirmation/reset tokens
5. **Rate limiting**: Gi·ªõi h·∫°n s·ªë email g·ª≠i m·ªói IP/user

## Troubleshooting

### L·ªói th∆∞·ªùng g·∫∑p:
1. **"Authentication failed"**: Ki·ªÉm tra app password
2. **"SMTP server not found"**: Ki·ªÉm tra SMTP server v√† port  
3. **"SSL/TLS error"**: ƒê·∫£m b·∫£o EnableSsl = true
4. **"Timeout"**: Ki·ªÉm tra firewall/proxy settings

### Debug logging:
```csharp
services.AddLogging(builder => builder.AddConsole());
```

## M·ªü r·ªông

C√≥ th·ªÉ th√™m:
- Email templates t·ª´ database
- Multi-language support
- Email queuing system (Hangfire)
- Email tracking (opens, clicks)
- Unsubscribe functionality
- Rich text editor cho admin